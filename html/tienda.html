<!doctype html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Todos los productos — MagicColombia</title>

  <!-- Tu CSS general -->
  <link rel="stylesheet" href="../css/style.magiccolombia.css" />
  <link rel="icon" type="image/png" href="../images/Logo/01.png" />
</head>

<body class="theme-light page-catalog-all density-roomy" style="--thumb-h:220px">
  <!-- Preloader (se oculta en DOMContentLoaded por si algún JS falla) -->
  <div id="preloader" role="status" aria-live="polite"><div class="spinner" aria-hidden="true"></div></div>

  <!-- ======= HEADER ======= -->
  <header class="site-header">
    <div class="nav">
      <div class="nav-left">
        <!-- Logo (sin cambios) -->
        <a class="brand" href="/cosmix/html/tienda.html" aria-label="MagicColombia">
          <img src="/cosmix/images/Logo/01.png" alt="MagicColombia">
        </a>

        <!-- Menú primario (se deja simple y funcional) -->
        <nav id="primary-menu" class="menu menu-icons" aria-label="Navegación principal">
          <a href="/cosmix/html/catalogo.html" class="icon-link" title="Catálogo" aria-label="Catálogo">
            <svg aria-hidden="true" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="2"></rect>
              <rect x="14" y="3" width="7" height="7" rx="2"></rect>
              <rect x="3" y="14" width="7" height="7" rx="2"></rect>
              <rect x="14" y="14" width="7" height="7" rx="2"></rect>
            </svg>
            <span class="sr-only">Catálogo</span>
          </a>

          <a href="/cosmix/html/blog.html" class="icon-link" title="Post" aria-label="Post">
            <svg aria-hidden="true" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="4" width="18" height="16" rx="2"></rect>
              <line x1="7" y1="8" x2="17" y2="8"></line>
              <line x1="7" y1="12" x2="17" y2="12"></line>
              <line x1="7" y1="16" x2="12" y2="16"></line>
            </svg>
            <span class="sr-only">Post</span>
          </a>
        </nav>
      </div>

      <!-- Autenticación / Estado de sesión -->
      <div class="auth-ctas">
        <!-- Invitado -->
        <a class="btn-outline" href="/cosmix/html/login.html"    data-guest>Iniciar sesión</a>
        <a class="btn"         href="/cosmix/html/registro.html" data-guest>Crear cuenta</a>

        <!-- Con sesión: píldora CMX (enlace al admin) -->
        <a href="/cosmix/html/admin.html" class="logo-badge" data-user hidden>CMX</a>
        <a class="btn-outline" href="#" data-logout data-user hidden>Salir</a>
      </div>

      <button class="burger" type="button" data-menu-toggle aria-label="Abrir menú"
              aria-controls="primary-menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- ======= CONTENIDO ======= -->
<main>
  <section class="container pad-y">
    <h1 class="h2">Todos los productos</h1>

    <!-- Toolbar: buscador + ordenar + densidad + stock + contador + refrescar -->
    <div class="filters-card mt-3" id="filters">
      <div class="filters-row wrap">
        <div class="field grow with-icon">
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <circle cx="11" cy="11" r="7"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <!-- q -> search -->
          <input id="search" class="input pill" type="search" placeholder="Buscar por nombre o SKU…" autocomplete="off" />
        </div>

        <select id="sort" class="select pill" aria-label="Ordenar">
          <option value="name-asc">Alfabéticamente, A–Z</option>
          <option value="name-desc">Alfabéticamente, Z–A</option>
          <option value="price-asc">Precio, menor a mayor</option>
          <option value="price-desc">Precio, mayor a menor</option>
        </select>

        <div class="view-group" role="group" aria-label="Densidad">
          <button id="densCompact" class="icon-pill" title="Compacto" aria-pressed="false">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="2"/><rect x="14" y="3" width="7" height="7" rx="2"/>
            </svg>
          </button>
          <button id="densStandard" class="icon-pill is-active" title="Estándar" aria-pressed="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="2"/><rect x="14" y="3" width="7" height="7" rx="2"/><rect x="3" y="14" width="7" height="7" rx="2"/>
            </svg>
          </button>
          <button id="densRoomy" class="icon-pill" title="Amplio" aria-pressed="false">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="2"/><rect x="14" y="3" width="7" height="7" rx="2"/><rect x="3" y="14" width="7" height="7" rx="2"/><rect x="14" y="14" width="7" height="7" rx="2"/>
            </svg>
          </button>
        </div>

        <!-- onlyInStock -> onlyStock -->
        <label class="switch" title="Solo disponibles">
          <input id="onlyStock" type="checkbox" />
          <span></span><em>Solo disponibles</em>
        </label>

        <!-- count -> countLabel -->
        <div class="count small" id="countLabel">Mostrando 0 productos</div>

        <button id="refresh" class="btn" type="button">Refrescar</button>
      </div>

      <!-- chips / rangos de precio -->
      <div class="filters-row chips">
        <!-- data-cat -> data-category / valores normalizados -->
        <button class="chip is-active" data-category="all"><span class="dot" style="background:#7c3aed"></span> Todas</button>
        <button class="chip" data-category="boardgame"><span class="dot" style="background:#059669"></span> Juegos de mesa</button>
        <button class="chip" data-category="tcg"><span class="dot" style="background:#0ea5e9"></span> TCG / Cartas</button>
        <button class="chip" data-category="acc"><span class="dot" style="background:#f59e0b"></span> Accesorios</button>
        <!-- tag sigue igual -->
        <button class="chip" data-tag="lanzamiento"><span class="dot" style="background:#8b5cf6"></span> Lanzamiento</button>

        <div class="price-range" style="margin-left:auto;display:flex;gap:10px;align-items:center">
          <input id="minPrice" type="number" class="input pill sm" placeholder="Mín $" min="0" inputmode="numeric">
          <span class="dash">—</span>
          <input id="maxPrice" type="number" class="input pill sm" placeholder="Máx $" min="0" inputmode="numeric">
        </div>
      </div>
    </div>

    <!-- Grid de productos -->
    <ul id="product-grid" class="fc-grid" aria-live="polite" style="margin-top:24px;"></ul>
  </section>
</main>

  <!-- Paginación -->
  <nav id="pager" class="pagination" aria-label="Paginación"></nav>

  <!-- ======= FOOTER ======= -->
  <footer class="site-footer">
    <div class="container grid">
      <section>
        <h4>MagicColombia</h4>
        <p>Desde 2002 con la comunidad TCG.</p>
        <small>© 2025 MagicColombia. Todos los derechos reservados.</small>
      </section>
      <section>
        <h4>Links Rápidos</h4>
        <ul>
          <li><a href="search.html">Búsqueda</a></li>
          <li><a href="terminos.html">Términos del servicio</a></li>
          <li><a href="reembolsos.html">Política de reembolso</a></li>
        </ul>
      </section>
      <section>
        <h4>Sobre Nosotros</h4>
        <p>Carrera 65 # 5-107 · Cali · Colombia</p>
        <p>E-mail: <a href="mailto:ventas@magiccolombia.com">ventas@magiccolombia.com</a></p>
        <p>WhatsApp/Celular 3045511764</p>
      </section>
    </div>
  </footer>

  <!-- ======= JS ======= -->
  <!-- Snippets front (si ya lo usas) -->
  <script src="/cosmix/magic_auth_php/snippets_front.js" defer></script>

  <!-- Ping de sesión para alternar botones + logout -->
  <script>
  (async () => {
    try {
      const res = await fetch('/cosmix/magic_auth_php/ping.php', { credentials: 'include' });
      const data = await res.json().catch(() => ({}));
      const logged = data && data.ok === true && (data.usuario || data.uid);

      const show = el => el && (el.hidden = false);
      const hide = el => el && (el.hidden = true);

      document.querySelectorAll('[data-guest]').forEach(el => logged ? hide(el) : show(el));
      document.querySelectorAll('[data-user]').forEach(el  => logged ? show(el) : hide(el));

      const bye = document.querySelector('[data-logout]');
      if (bye) {
        bye.addEventListener('click', async (e) => {
          e.preventDefault();
          await fetch('/cosmix/magic_auth_php/logout.php', { method: 'POST', credentials: 'include' });
          location.href = '/cosmix/html/login.html';
        });
      }
    } catch {}
  })();
  </script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const k = 'cosmix_refresh';
  if (localStorage.getItem(k)) {
    localStorage.removeItem(k);
    // vuelve a pedir los productos o recarga
    try {
      // si tienes una función para recargar grid, llámala:
      if (typeof cargarTienda === 'function') { cargarTienda(); }
      else { location.reload(); }
    } catch { location.reload(); }
  }
});
</script>


  <!-- Data y lógica de tienda (se respetan tus JS) -->
  <script src="../js/data.products.js" defer></script>
  <script src="../js/products.lanzamiento.js" defer></script>
  <script src="../js/tienda.js" defer></script>

  <!-- Fix de ruta para tus mejoras de UI (menú, etc) -->
  <script src="/cosmix/js/site.enhancements.js" defer></script>

  <!-- Botón Refrescar: simple (recarga) y failsafe del preloader -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pre = document.getElementById('preloader');
      if (pre) pre.style.display = 'none';

      const btn = document.getElementById('refresh');
      if (btn) btn.addEventListener('click', () => location.reload());
    });
  </script>
</body>
</html>
